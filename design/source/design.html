<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>design.html</title>

</head>

<body>

<h2 id="the-project">The Project</h2>
<p>In this project i am going to implement Pong from scratch for an Arduino Uno with an <a href="https://www.arduino.cc/en/Guide/TFT">Arduino TFT</a>.</p>
<p>My project goals are the following:</p>
<ul>
<li>Learn about programming for embedded hardware (Arduino)</li>
<li>Generally raise my programming experience</li>
</ul>
<h3 id="tools">Tools</h3>
<p>The following tools and libraries will be used in the project:</p>
<ul>
<li>CMake with <a href="https://github.com/queezythegreat/arduino-cmake">Arduino CMake</a></li>
<li>Arduino SDK and TFT library</li>
<li><a href="https://github.com/onqtam/doctest">doctest</a> for unit tests</li>
</ul>
<p>Arduino CMake uses gcc-avr to compile the c++ code. This means that exceptions are disabled by default(-fno-exceptions).</p>
<p>I additionally apply the following restrictions:</p>
<ul>
<li>No use of RTTI (-fno-rtti). RTTI costs time and space. I don't plan to use any or much inheritance.</li>
<li>No dynamic memory allocation. While Arduino supports <code class="sourceCode cpp"><span class="kw">operator</span> <span class="kw">new</span></code>, i will not use it.</li>
</ul>
<h2 id="pong">Pong</h2>
<p>(source/figures/gen/pong_complete)(Pong) ~<sub>~</sub> +------------------------------+ |+--+ | || | | || | | || | +--+| || | /-  | || |+--+ -/ | || | | || | | || | +--+| | | | | | | +------------------------------+ ~<sub>~</sub></p>
<p>Pong is a simple game the players control paddles to hit the ball back to the opponent. If a player fails to catch the ball, the opponent receives one point. The points if the player are shown as text inside the players field.</p>
<p>The following objects make up the game:</p>
<ul>
<li>Two paddles</li>
<li>A ball</li>
</ul>
<h3 id="details">Details</h3>
<p>Since the ball can hit the paddles, collision checks need to be performed. The original Pong had segmented paddles. The segment the ball hits determents the return angle of the ball. Hitting the ball with the center of the paddle returns the ball with an 90° angle. Other parts of the paddle return the ball at smaller angles.</p>
<p>The Game is targeted to run on the Arduino TFT. This means that the dimensions of the screen are known beforehand and will never change. Compared to desktop development, this makes things easier. The screen has dimensions of 160 x 128 :</p>
<p>(source/figures/gen/screen)(The TFT-Screen) ~<sub>~</sub> +--------------+ - | | | | | | | | |128 | | | | | | +--------------+ -</p>
<p>|-----160------| ~<sub>~</sub></p>
<p>We can now define:</p>
<dl>
<dt><strong>Paddle</strong></dt>
<dd><ul>
<li>Width: 6px</li>
<li>Height: 20px</li>
</ul>
</dd>
<dt><strong>Ball</strong></dt>
<dd><ul>
<li>Width: 4px</li>
<li>Height: 4px</li>
</ul>
</dd>
</dl>
<p>The following shows the relative sizes of the objects:</p>
<div class="figure">
<img src="source/figures/field_drawn.png" alt="Pictures showing relatives sizes" style="width:200.0%" style="height:200.0%" />
<p class="caption">Pictures showing relatives sizes</p>
</div>
<h1 id="implementation-design">Implementation Design</h1>
<h2 id="classes">Classes</h2>
<p>The high level design is shown in the following diagram:</p>
<p>(source/figures/gen/pong)(Top-level class diagram) ~<sub>~</sub> namespace pong { class Paddle class Ball class GameField class Game class Renderer class CollisionProcessor class Input</p>
<pre><code>GameField &quot;1&quot; *-- &quot;2&quot; Paddle
GameField &quot;1&quot; *-- &quot;1&quot; Ball

Game o-- GameField

Renderer ..&gt; Paddle : draws
Renderer ..&gt; Ball : draws

GameField ..&gt; CollisionProcessor : &lt;&lt;uses&gt;&gt;
GameField ..&gt; Input : &lt;&lt;uses&gt;&gt;</code></pre>
<p>} ~<sub>~</sub></p>
<h3 id="game">Game</h3>
<p>(source/figures/gen/uml_game)(Class diagram of <a href="#game">Game</a>) ~<sub>~</sub> class Game { - gameField_ : GameField - renderer_ : Renderer + run() : void } ~<sub>~</sub></p>
<p>The Game class includes the <a href="http://gameprogrammingpatterns.com/game-loop.html">Game Loop</a>. It has an instance of <a href="#gamefield">GameField</a> and will call <code>update()</code> and <code>render()</code> methods on it. <code>run()</code> will be directly called from <code>main</code> and represents the main loop of the program.</p>
<p>Pseudo code:</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> Game::run()
{
    gameField_.update();
    gameField_.render(renderer_);
}</code></pre></div>
<h3 id="gamefield">GameField</h3>
<p>(source/figures/gen/uml_gamefield)(Class diagram for <a href="#gamefield">GameField</a>) <sub>~</sub> class GameField { - paddles_ : Paddle[2] - ball_ : Ball - collision_ : CollisionProcessor</p>
<pre><code>+ update() : void
+ render(renderer : Renderer&amp;) : void</code></pre>
<p>} <sub>~</sub></p>
<p>GameField represents the pong field. It contains the ball and the paddles. In <code>update()</code> and <code>render()</code> it handles movement and collision of the ball and the paddles. The <code>render()</code> method uses the <code>Renderer</code> to draw the ball and paddles on the screen.</p>
<p>Pseudo code:</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> GameField::update()
{
    movePaddlesAccordingToInput();
    moveBall();
    checkBallCollision();
}
<span class="dt">void</span> GameField::render(Renderer&amp; renderer)
{
    renderer.render(ball_);
    renderer.render(paddles_[<span class="dv">0</span>]);
    renderer.render(paddles_[<span class="dv">1</span>]);
}</code></pre></div>
<h3 id="ball-and-paddle">Ball and Paddle</h3>
<p>We can model both of these with rectangles. In addition of width and height, the Rectangle class gets x and y for position:</p>
<p>(source/figures/gen/uml_rectangle)(Class diagram Rectangle) ~<sub>~</sub> class Rectangle { -x : int -y : int -width : int -height : int -- getters and setters } ~<sub>~</sub></p>
<p>Ball and Paddle are then defined as follows:</p>
<p>(source/figures/gen/uml_ball)(Class diagram Ball) ~<sub>~</sub> class Ball { -rectangle_ : Rectangle -angle_ : float -velocity_ : float -- getters and setters } ~<sub>~</sub></p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">using</span> Paddle = Rectangle;</code></pre></div>
<h3 id="collisionprocessor">CollisionProcessor</h3>
<p>(source/figures/gen/uml_collision)(Class diagram CollisionProcessor) ~<sub>~</sub> class ColisionProcessor { +bool checkCollision(l : const Rectangle&amp;, r : const Rectangle&amp;) } ~<sub>~</sub></p>
<p>Checks collisions between rectangles. <code>checkCollision()</code> checks if the two rectangles collide in any way. This includes one rectangle being contained in another.</p>
<h3 id="renderer">Renderer</h3>
<p>(source/figures/gen/uml_render)(Class diagram Renderer) ~<sub>~</sub> class Renderer { +render(rect: const Rectangle&amp;) } ~<sub>~</sub></p>
<p>Renderer renders various thing to the screen.</p>

</body>
</html>
